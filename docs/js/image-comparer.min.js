/**
 * Materialize Image Comparer - A little plugin that implements a image comparer (based on MetroUI) to Materializecss framework.
 * @version v1.0.0
 * @author Eduardo Oliveira (EduardoJM) <eduardo_y05@outlook.com>.
 * @link https://github.com/EduardoJM/Materialize-Image-Comparer
 * 
 * Licensed under the MIT License (https://github.com/EduardoJM/Materialize-Image-Comparer/blob/master/LICENSE).
 */

"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var ImageCompare=function(){function i(t){var n=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,i),_defineProperty(this,"_moveAll",function(t){var e=n._utilGetWidth(n.element),i=n._utilGetCursorPosition(n.element,t).x;i<0&&(i=0),e<i&&(i=e),n.containerOverlay.style.width="".concat(i,"px");var s=i-n._utilGetWidth(n.slider)/2;n.slider.style.left="".concat(s,"px"),null!=n.options.onSliderMove&&void 0!==n.options.onSliderMove&&n.options.onSliderMove(i,s,n.slider)}),_defineProperty(this,"_stopAll",function(t){document.removeEventListener("mousemove",n._moveAll),document.removeEventListener("touchmove",n._moveAll)}),_defineProperty(this,"_startAll",function(t){document.addEventListener("mousemove",n._moveAll),document.addEventListener("touchmove",n._moveAll),document.addEventListener("mouseup",n._stopAll),document.addEventListener("touchend",n._stopAll)}),_defineProperty(this,"_resize",function(){var e=n._utilGetWidth(n.element),i=n.options.height;"16/9"===n.options.height||"21/9"===n.options.height||"4/3"===n.options.height?i=n._utilAspectRatioH(e,n.options.height):"auto"===n.options.height&&(i=n._utilAspectRatioH(e,"16/9")),n.element.style.height="".concat(i,"px"),document.querySelectorAll(".image-wrapper").forEach(function(t){t.style.width="".concat(e,"px"),t.style.height="".concat(i,"px")}),n.containerOverlay.style.width="".concat(e/2,"px");var t=i/2-n._utilGetHeight(n.slider)/2,s=e/2-n._utilGetWidth(n.slider)/2;n.slider.style.top="".concat(t,"px"),n.slider.style.left="".concat(s,"px"),null!=n.options.onResize&&void 0!==n.options.onResize&&n.options.onResize(e,i,n.element)}),_defineProperty(this,"_utilGetCursorPosition",function(t,e){var i=t.getBoundingClientRect(),s=e.changedTouches?e.changedTouches[0].pageX:e.pageX,n=e.changedTouches?e.changedTouches[0].pageY:e.pageY;return{x:s-i.left-window.pageXOffset,y:n-i.top-window.pageYOffset}}),_defineProperty(this,"_utilRandomInt",function(t,e){return Math.floor(Math.random()*(e-t+1)+t)}),_defineProperty(this,"_utilGenerateId",function(t){var e=(new Date).getTime(),i=n._utilRandomInt(1,1e3);return"".concat(t,"-").concat(e).concat(i)}),this.options=Object.assign({width:"100%",height:"auto",sliderClass:"",sliderContent:"",onResize:null,onSliderMove:null},e),this.element=t,this._setOptionsFromDOM(),this._create()}return _createClass(i,[{key:"_setOptionsFromDOM",value:function(){for(var t=Object.keys(this.element.dataset),e=0;e<t.length;e+=1){var i=t[e];if(Object.prototype.hasOwnProperty.call(this.options,i)){var s=this.element.dataset[i];try{this.options[i]=JSON.parse(s)}catch(t){this.options[i]=s}}}}},{key:"_create",value:function(){this._createStructure(),this._createEvents()}},{key:"_createStructure",value:function(){var s=this,t=this.element.getAttribute("id");null!=t&&void 0!==t&&""!==t||(t=this._utilGenerateId("image-compare"),this.element.setAttribute("id",t)),this.element.classList.add("image-compare"),this.options.width.toString().endsWith("%")||this.options.width.toString().endsWith("px")?this.element.style.width=this.options.width:this.element.style.width="".concat(this.options.width,"px");var n=this._utilGetWidth(this.element),o=parseInt(this.options.height);"16/9"===this.options.height||"21/9"===this.options.height||"4/3"===this.options.height?o=this._utilAspectRatioH(n,this.options.height):"auto"===this.options.height&&(o=this._utilAspectRatioH(n,"16/9")),this.element.style.height="".concat(o,"px"),this.container=document.createElement("div"),this.container.classList.add("image-container"),this.element.append(this.container),this.containerOverlay=document.createElement("div"),this.containerOverlay.classList.add("image-container-overlay"),this.containerOverlay.style.width="".concat(n/2,"px"),this.element.append(this.containerOverlay),this.slider=document.createElement("div"),this.slider.classList.add("image-slider"),null!=this.options.sliderClass&&void 0!==this.options.sliderClass&&""!==this.options.sliderClass&&this.options.sliderClass!==[]&&("string"==typeof this.options.sliderClass?this.slider.classList.add(this.options.sliderClass):Array.isArray(this.options.sliderClass)&&this.options.sliderClass.forEach(function(t){s.slider.classList.add(t)})),null!=this.options.sliderContent&&void 0!==this.options.sliderContent&&""!==this.options.sliderContent&&(this.slider.innerHTML=this.options.sliderContent),this.element.append(this.slider);var e=o/2-this._utilGetHeight(this.slider)/2,i=n/2-this._utilGetWidth(this.slider)/2;this.slider.style.top="".concat(e,"px"),this.slider.style.left="".concat(i,"px"),this.element.querySelectorAll("img").forEach(function(t,e){var i=document.createElement("div");i.classList.add("image-wrapper"),i.style.width="".concat(n,"px"),i.style.height="".concat(o,"px"),i.style.backgroundImage="url(".concat(t.src,")"),0===e?s.container.append(i):s.containerOverlay.append(i)})}},{key:"_createEvents",value:function(){this.slider.addEventListener("mousedown",this._startAll),this.slider.addEventListener("touchstart",this._startAll),window.addEventListener("resize",this._resize)}},{key:"_utilGetWidth",value:function(t){return parseFloat(getComputedStyle(t,null).width.replace("px",""))}},{key:"_utilGetHeight",value:function(t){return parseFloat(getComputedStyle(t,null).height.replace("px",""))}},{key:"_utilAspectRatioH",value:function(t,e){return"16/9"===e?9*t/16:"21/9"===e?9*t/21:"4/3"===e?3*t/4:0}}]),i}();