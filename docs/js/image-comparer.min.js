/**
 * Image Comparer - A little plugin that implements a image comparer.
 * @version v1.0.1
 * @author Eduardo Oliveira (EduardoJM) <eduardo_y05@outlook.com>.
 * @link https://github.com/EduardoJM/Image-Comparer
 * 
 * Licensed under the MIT License (https://github.com/EduardoJM/Image-Comparer/blob/master/LICENSE).
 */

"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],n=!0,s=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(n=(r=l.next()).done)&&(i.push(r.value),!t||i.length!==t);n=!0);}catch(e){s=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(s)throw o}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var ImageCompareDefaultOptions={width:"100%",height:"auto",sliderClass:"",sliderContent:"",onResize:null,onSliderMove:null},ImageCompare=function(){function l(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,l);var i=_slicedToArray("ontouchstart"in document.documentElement?["touchend","touchstart","touchmove"]:["mouseup","mousedown","mousemove"],3),n=i[0],s=i[1],o=i[2];this.deviceEvents={up:n,down:s,move:o},this.options=Object.assign({},ImageCompareDefaultOptions,t),this.element=e,this.setOptionsFromDOM(),this.eventMoveAll=this.eventMoveAll.bind(this),this.eventResize=this.eventResize.bind(this),this.eventStartAll=this.eventStartAll.bind(this),this.events={RESIZE:new Event("resize"),SLIDERMOVE:new Event("slidermove")},this.create()}return _createClass(l,[{key:"setOptionsFromDOM",value:function(){for(var e=Object.keys(this.element.dataset),t=0;t<e.length;t+=1){var i=e[t];if(Object.prototype.hasOwnProperty.call(this.options,i)){var n=this.element.dataset[i];try{this.options[i]=JSON.parse(n)}catch(e){this.options[i]=n}}}}},{key:"create",value:function(){this.createStructure(),this.createEvents()}},{key:"applySize",value:function(){this.options.width.toString().endsWith("%")||this.options.width.toString().endsWith("px")?this.element.style.width=this.options.width:this.element.style.width="".concat(this.options.width,"px");var e=l.utilGetWidth(this.element),t=parseInt(this.options.height,10);return"16/9"===this.options.height||"21/9"===this.options.height||"4/3"===this.options.height?t=l.utilAspectRatioH(e,this.options.height):"auto"===this.options.height&&(t=l.utilAspectRatioH(e,"16/9")),this.element.style.height="".concat(t,"px"),{elementWidth:e,elementHeight:t}}},{key:"applySizeComplete",value:function(){var e=this.applySize(),i=e.elementWidth,n=e.elementHeight;this.element.querySelectorAll(".image-wrapper").forEach(function(e){var t=e;t.style.width="".concat(i,"px"),t.style.height="".concat(n,"px")}),this.containerOverlay.style.width="".concat(i/2,"px");var t=n/2-l.utilGetHeight(this.slider)/2,s=i/2-l.utilGetWidth(this.slider)/2;return this.slider.style.top="".concat(t,"px"),this.slider.style.left="".concat(s,"px"),{elementWidth:i,elementHeight:n}}},{key:"createStructure",value:function(){var n=this,e=this.element.getAttribute("id");null!=e&&void 0!==e&&""!==e||(e=l.utilGenerateId("image-compare"),this.element.setAttribute("id",e)),this.element.classList.add("image-compare");var t=this.applySize(),s=t.elementWidth,o=t.elementHeight;this.container=document.createElement("div"),this.container.classList.add("image-container"),this.element.append(this.container),this.containerOverlay=document.createElement("div"),this.containerOverlay.classList.add("image-container-overlay"),this.containerOverlay.style.width="".concat(s/2,"px"),this.element.append(this.containerOverlay),this.slider=document.createElement("div"),this.slider.classList.add("image-slider"),null!=this.options.sliderClass&&void 0!==this.options.sliderClass&&""!==this.options.sliderClass&&this.options.sliderClass!==[]&&("string"==typeof this.options.sliderClass?this.options.sliderClass.split(" ").forEach(function(e){n.slider.classList.add(e)}):Array.isArray(this.options.sliderClass)&&this.options.sliderClass.forEach(function(e){n.slider.classList.add(e)}));null!=this.options.sliderContent&&void 0!==this.options.sliderContent&&""!==this.options.sliderContent&&(this.slider.innerHTML=this.options.sliderContent),this.element.append(this.slider);var i=o/2-l.utilGetHeight(this.slider)/2,r=s/2-l.utilGetWidth(this.slider)/2;this.slider.style.top="".concat(i,"px"),this.slider.style.left="".concat(r,"px"),this.element.querySelectorAll("img").forEach(function(e,t){var i=document.createElement("div");i.classList.add("image-wrapper"),i.style.width="".concat(s,"px"),i.style.height="".concat(o,"px"),i.style.backgroundImage="url(".concat(e.src,")"),0===t?n.container.append(i):n.containerOverlay.append(i)})}},{key:"eventMoveAll",value:function(e){var t=l.utilGetWidth(this.element),i=l.utilGetCursorPosition(this.element,e).x;i<0&&(i=0),t<i&&(i=t),this.containerOverlay.style.width="".concat(i,"px");var n=i-l.utilGetWidth(this.slider)/2;this.slider.style.left="".concat(n,"px"),null!=this.options.onSliderMove&&void 0!==this.options.onSliderMove&&this.options.onSliderMove(i,n,this.slider),this.element.dispatchEvent(this.events.SLIDERMOVE)}},{key:"shouldMoveAll",value:function(e){document[e?"addEventListener":"removeEventListener"](this.deviceEvents.move,this.eventMoveAll)}},{key:"eventStartAll",value:function(){var e=this;this.shouldMoveAll(!0),document.addEventListener(this.deviceEvents.up,function(){e.shouldMoveAll(!1)})}},{key:"eventResize",value:function(){var e=this.applySizeComplete(),t=e.elementWidth,i=e.elementHeight;null!=this.options.onResize&&void 0!==this.options.onResize&&this.options.onResize(t,i,this.element),this.element.dispatchEvent(this.events.RESIZE)}},{key:"createEvents",value:function(){this.slider.addEventListener(this.deviceEvents.down,this.eventStartAll),window.addEventListener("resize",this.eventResize)}}],[{key:"utilGetCursorPosition",value:function(e,t){var i=e.getBoundingClientRect(),n=t.changedTouches?t.changedTouches[0].pageX:t.pageX,s=t.changedTouches?t.changedTouches[0].pageY:t.pageY;return{x:n-i.left-window.pageXOffset,y:s-i.top-window.pageYOffset}}},{key:"utilGetWidth",value:function(e){return parseFloat(getComputedStyle(e,null).width.replace("px",""))}},{key:"utilGetHeight",value:function(e){return parseFloat(getComputedStyle(e,null).height.replace("px",""))}},{key:"utilAspectRatioH",value:function(e,t){return"16/9"===t?9*e/16:"21/9"===t?9*e/21:"4/3"===t?3*e/4:0}},{key:"utilRandomInt",value:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}},{key:"utilGenerateId",value:function(e){var t=(new Date).getTime(),i=l.utilRandomInt(1,1e3);return"".concat(e,"-").concat(t).concat(i)}}]),l}();