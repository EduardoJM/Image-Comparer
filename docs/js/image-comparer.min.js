/**
 * Materialize Image Comparer - A little plugin that implements a image comparer (based on MetroUI) to Materializecss framework.
 * @version v1.0.1
 * @author Eduardo Oliveira (EduardoJM) <eduardo_y05@outlook.com>.
 * @link https://github.com/EduardoJM/Materialize-Image-Comparer
 * 
 * Licensed under the MIT License (https://github.com/EduardoJM/Materialize-Image-Comparer/blob/master/LICENSE).
 */

"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var ImageCompare=function(){function i(e){var s=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,i),_defineProperty(this,"_moveAll",function(e){var t=s._utilGetWidth(s.element),i=s._utilGetCursorPosition(s.element,e).x;i<0&&(i=0),t<i&&(i=t),s.containerOverlay.style.width="".concat(i,"px");var n=i-s._utilGetWidth(s.slider)/2;s.slider.style.left="".concat(n,"px"),null!=s.options.onSliderMove&&void 0!==s.options.onSliderMove&&s.options.onSliderMove(i,n,s.slider)}),_defineProperty(this,"_stopAll",function(e){document.removeEventListener("mousemove",s._moveAll),document.removeEventListener("touchmove",s._moveAll)}),_defineProperty(this,"_startAll",function(e){document.addEventListener("mousemove",s._moveAll),document.addEventListener("touchmove",s._moveAll),document.addEventListener("mouseup",s._stopAll),document.addEventListener("touchend",s._stopAll)}),_defineProperty(this,"_resize",function(){var e=s._applySizeComplete(),t=e.element_width,i=e.element_height;null!=s.options.onResize&&void 0!==s.options.onResize&&s.options.onResize(t,i,s.element)}),_defineProperty(this,"_utilGetCursorPosition",function(e,t){var i=e.getBoundingClientRect(),n=t.changedTouches?t.changedTouches[0].pageX:t.pageX,s=t.changedTouches?t.changedTouches[0].pageY:t.pageY;return{x:n-i.left-window.pageXOffset,y:s-i.top-window.pageYOffset}}),_defineProperty(this,"_utilRandomInt",function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}),_defineProperty(this,"_utilGenerateId",function(e){var t=(new Date).getTime(),i=s._utilRandomInt(1,1e3);return"".concat(e,"-").concat(t).concat(i)}),this.options=Object.assign({width:"100%",height:"auto",sliderClass:"",sliderContent:"",onResize:null,onSliderMove:null},t),this.element=e,this._setOptionsFromDOM(),this._create()}return _createClass(i,[{key:"_setOptionsFromDOM",value:function(){for(var e=Object.keys(this.element.dataset),t=0;t<e.length;t+=1){var i=e[t];if(Object.prototype.hasOwnProperty.call(this.options,i)){var n=this.element.dataset[i];try{this.options[i]=JSON.parse(n)}catch(e){this.options[i]=n}}}}},{key:"_create",value:function(){this._createStructure(),this._createEvents()}},{key:"_applySize",value:function(){this.options.width.toString().endsWith("%")||this.options.width.toString().endsWith("px")?this.element.style.width=this.options.width:this.element.style.width="".concat(this.options.width,"px");var e=this._utilGetWidth(this.element),t=parseInt(this.options.height);return"16/9"===this.options.height||"21/9"===this.options.height||"4/3"===this.options.height?t=this._utilAspectRatioH(e,this.options.height):"auto"===this.options.height&&(t=this._utilAspectRatioH(e,"16/9")),this.element.style.height="".concat(t,"px"),{element_width:e,element_height:t}}},{key:"_applySizeComplete",value:function(){var e=this._applySize(),t=e.element_width,i=e.element_height;this.element.querySelectorAll(".image-wrapper").forEach(function(e){e.style.width="".concat(t,"px"),e.style.height="".concat(i,"px")}),this.containerOverlay.style.width="".concat(t/2,"px");var n=i/2-this._utilGetHeight(this.slider)/2,s=t/2-this._utilGetWidth(this.slider)/2;return this.slider.style.top="".concat(n,"px"),this.slider.style.left="".concat(s,"px"),{element_width:t,element_height:i}}},{key:"_createStructure",value:function(){var n=this,e=this.element.getAttribute("id");null!=e&&void 0!==e&&""!==e||(e=this._utilGenerateId("image-compare"),this.element.setAttribute("id",e)),this.element.classList.add("image-compare");var t=this._applySize(),s=t.element_width,o=t.element_height;this.container=document.createElement("div"),this.container.classList.add("image-container"),this.element.append(this.container),this.containerOverlay=document.createElement("div"),this.containerOverlay.classList.add("image-container-overlay"),this.containerOverlay.style.width="".concat(s/2,"px"),this.element.append(this.containerOverlay),this.slider=document.createElement("div"),this.slider.classList.add("image-slider"),null!=this.options.sliderClass&&void 0!==this.options.sliderClass&&""!==this.options.sliderClass&&this.options.sliderClass!==[]&&("string"==typeof this.options.sliderClass?this.slider.classList.add(this.options.sliderClass):Array.isArray(this.options.sliderClass)&&this.options.sliderClass.forEach(function(e){n.slider.classList.add(e)})),null!=this.options.sliderContent&&void 0!==this.options.sliderContent&&""!==this.options.sliderContent&&(this.slider.innerHTML=this.options.sliderContent),this.element.append(this.slider);var i=o/2-this._utilGetHeight(this.slider)/2,l=s/2-this._utilGetWidth(this.slider)/2;this.slider.style.top="".concat(i,"px"),this.slider.style.left="".concat(l,"px"),this.element.querySelectorAll("img").forEach(function(e,t){var i=document.createElement("div");i.classList.add("image-wrapper"),i.style.width="".concat(s,"px"),i.style.height="".concat(o,"px"),i.style.backgroundImage="url(".concat(e.src,")"),0===t?n.container.append(i):n.containerOverlay.append(i)})}},{key:"_createEvents",value:function(){this.slider.addEventListener("mousedown",this._startAll),this.slider.addEventListener("touchstart",this._startAll),window.addEventListener("resize",this._resize)}},{key:"_utilGetWidth",value:function(e){return parseFloat(getComputedStyle(e,null).width.replace("px",""))}},{key:"_utilGetHeight",value:function(e){return parseFloat(getComputedStyle(e,null).height.replace("px",""))}},{key:"_utilAspectRatioH",value:function(e,t){return"16/9"===t?9*e/16:"21/9"===t?9*e/21:"4/3"===t?3*e/4:0}}]),i}();