/**
 * Image Comparer - A little plugin that implements a image comparer.
 * @version v1.0.1
 * @author Eduardo Oliveira (EduardoJM) <eduardo_y05@outlook.com>.
 * @link https://github.com/EduardoJM/Image-Comparer
 * 
 * Licensed under the MIT License (https://github.com/EduardoJM/Image-Comparer/blob/master/LICENSE).
 */

"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var ImageCompareDefaultOptions={width:"100%",height:"auto",sliderClass:"",sliderContent:"",onResize:null,onSliderMove:null},ImageCompare=function(){function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,a);var n=_slicedToArray("ontouchstart"in document.documentElement?["touchend","touchstart","touchmove"]:["mouseup","mousedown","mousemove"],3),i=n[0],r=n[1],n=n[2];this.deviceEvents={up:i,down:r,move:n},this.options=Object.assign({},ImageCompareDefaultOptions,t),this.element=e,this.setOptionsFromDOM(),this.eventMoveAll=this.eventMoveAll.bind(this),this.eventResize=this.eventResize.bind(this),this.eventStartAll=this.eventStartAll.bind(this),this.aspectRatios={"4/3":4/3,"16/9":16/9,"21/9":21/9,auto:16/9},this.events={RESIZE:new Event("resize"),SLIDERMOVE:new Event("slidermove")};t=this.applySize(),e=t.elementWidth,t=t.elementHeight;this.elementWidth=e,this.elementHeight=t,this.create()}return _createClass(a,[{key:"setOptionsFromDOM",value:function(){for(var e=Object.keys(this.element.dataset),t=0;t<e.length;t+=1){var n=e[t];if(Object.prototype.hasOwnProperty.call(this.options,n)){var i=this.element.dataset[n];try{this.options[n]=JSON.parse(i)}catch(e){this.options[n]=i}}}}},{key:"create",value:function(){this.createStructure(),this.createEvents()}},{key:"applySize",value:function(){var e=this.options,t=e.width,n=e.height,i=/\d+(px|%|em|rem)/;this.element.style.width=i.test(String(t))?t:"".concat(t,"px");e=a.utilGetWidth(this.element),t=0;return n in this.aspectRatios?(t=1/(this.aspectRatios[n]/e),this.element.style.height="".concat(t,"px")):(this.element.style.height=i.test(String(n))?n:"".concat(n,"px"),t=a.utilGetHeight(this.element)),{elementWidth:e,elementHeight:t}}},{key:"applySizeComplete",value:function(){var t=this.elementWidth,n=this.elementHeight;return this.element.querySelectorAll(".image-wrapper").forEach(function(e){a.insertElementStyle(e,{width:"".concat(t,"px"),height:"".concat(n,"px")})}),a.insertElementStyle(this.containerOverlay,{width:"".concat(t/2,"px")}),this.adjustSlider(),{elementWidth:t,elementHeight:n}}},{key:"createStructure",value:function(){var n=this,e=this.element.getAttribute("id")||a.utilGenerateId("image-compare"),i=this.elementWidth,r=this.elementHeight;this.element.setAttribute("id",e),this.element.classList.add("image-compare"),this.container=a.createElement({classList:"image-container",container:this.element}),this.containerOverlay=a.createElement({classList:"image-container-overlay",style:{width:"".concat(i/2,"px")},container:this.element}),this.slider=a.createElement({classList:"image-slider",beforeAppend:function(t){var e=n.options.sliderClass;e&&0!==Number(e)&&("string"==typeof e?e.split(" "):e).forEach(function(e){t.classList.add(e)}),n.options.sliderContent&&(t.innerHTML=e.sliderContent)},container:this.element}),this.adjustSlider(),this.element.querySelectorAll("img").forEach(function(e,t){t=0===t?n.container:n.containerOverlay;a.createElement({classList:"image-wrapper",style:{width:"".concat(i,"px"),height:"".concat(r,"px"),backgroundImage:"url(".concat(e.src,")")},container:t})})}},{key:"eventMoveAll",value:function(e){var t=a.utilGetWidth(this.element),e=a.utilGetCursorPosition(this.element,e).x,e=Math.max(0,Math.min(e,t));this.containerOverlay.style.width="".concat(e,"px");t=e-a.utilGetWidth(this.slider)/2;this.slider.style.left="".concat(t,"px"),this.options.onSliderMove&&this.options.onSliderMove(e,t,this.slider),this.element.dispatchEvent(this.events.SLIDERMOVE)}},{key:"shouldMoveAll",value:function(e){document[e?"addEventListener":"removeEventListener"](this.deviceEvents.move,this.eventMoveAll)}},{key:"eventStartAll",value:function(){var e=this;this.shouldMoveAll(!0),document.addEventListener(this.deviceEvents.up,function(){e.shouldMoveAll(!1)})}},{key:"eventResize",value:function(){var e=this.applySizeComplete(),t=e.elementWidth,e=e.elementHeight;this.element.dispatchEvent(this.events.RESIZE),this.options.onResize&&this.options.onResize(t,e,this.element)}},{key:"createEvents",value:function(){this.slider.addEventListener(this.deviceEvents.down,this.eventStartAll),window.addEventListener("resize",this.eventResize)}},{key:"adjustSlider",value:function(){var e=this.elementHeight/2-a.utilGetHeight(this.slider)/2,t=this.elementWidth/2-a.utilGetWidth(this.slider)/2;a.insertElementStyle(this.slider,{top:"".concat(e,"px"),left:"".concat(t,"px")})}},{key:"utilAspectRatioH",value:function(e,t){return e/this.aspectRatios[t]||this.aspectRatios[0]}}],[{key:"insertElementStyle",value:function(e,t){Object.assign(e.style,t)}},{key:"createElement",value:function(e){var t=e.classList,n=void 0===t?"":t,i=e.style,r=void 0===i?{}:i,t=e.container,i=e.beforeAppend,e=void 0===i?function(){}:i,i=document.createElement("div");return i.classList.add(n),a.insertElementStyle(i,r),e(i),t.append(i),i}},{key:"utilGetCursorPosition",value:function(e,t){var n=e.getBoundingClientRect(),e=(t.changedTouches?t.changedTouches[0]:t).pageX,t=(t.changedTouches?t.changedTouches[0]:t).pageY;return{x:e-n.left-window.pageXOffset,y:t-n.top-window.pageYOffset}}},{key:"utilGetDimension",value:function(e){return 1===e.length?String(parseFloat.apply(void 0,_toConsumableArray(e))):e.map(function(e){return String(parseFloat(e))})}},{key:"utilGetWidth",value:function(e){return a.utilGetDimension([getComputedStyle(e,null).width])}},{key:"utilGetHeight",value:function(e){return a.utilGetDimension([getComputedStyle(e,null).height])}},{key:"utilRandomInt",value:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}},{key:"utilGenerateId",value:function(e){var t=(new Date).getTime(),n=a.utilRandomInt(1,1e3);return"".concat(e,"-").concat(t).concat(n)}}]),a}();